# Optional Webhook Trigger for demo-B
#
# Place this file at: copybara-demo-B/.github/workflows/trigger-sync.yml
#
# This workflow triggers the B→A sync in demo-A immediately when main branch
# in demo-B changes, instead of waiting for the scheduled poll (30 minutes).
#
# Requirements:
# - Same COPYBARA_DEMO_TOKEN secret used in demo-A
# - Token must have workflow dispatch permissions

name: Trigger Copybara Sync to demo-A

on:
  push:
    branches:
      - main

jobs:
  trigger-sync:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger B→A Sync in demo-A
        run: |
          echo "Triggering sync workflow in demo-A..."

          curl -X POST \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: token ${{ secrets.COPYBARA_DEMO_TOKEN }}" \
            https://api.github.com/repos/daquinteroflex/copybara-demo-A/dispatches \
            -d '{"event_type":"demo-b-updated","client_payload":{"sha":"${{ github.sha }}","ref":"${{ github.ref }}"}}'

          echo "✅ Sync triggered successfully"
          echo "The B→A sync workflow in demo-A will start shortly"
